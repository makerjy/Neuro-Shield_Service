<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Stage2 ANN Model Explainer</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&family=Noto+Sans+KR:wght@400;500;700&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="theme.css" />
    <link rel="stylesheet" href="styles.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <div class="bg-layer"></div>
    <header class="topbar">
      <div>
        <p class="eyebrow">Neuro-Shield</p>
        <h1>Stage2 ANN Model Explainer</h1>
        <p id="modelInfo" class="subtext">모델 메타 로딩 중...</p>
      </div>
      <div class="run-meta">
        <div class="meta-line">
          <span>run_id</span>
          <code id="runIdText">-</code>
        </div>
        <div class="meta-line">
          <span>status</span>
          <span id="statusBadge" class="badge idle">IDLE</span>
        </div>
        <div class="meta-line">
          <span>updated</span>
          <code id="runUpdatedAt">-</code>
        </div>
      </div>
    </header>

    <main class="layout">
      <section class="panel left-panel">
        <div class="tabs">
          <button class="tab-btn active" data-tab="sampleTab">샘플 케이스</button>
          <button class="tab-btn" data-tab="manualTab">수동 입력</button>
        </div>

        <div id="sampleTab" class="tab-content active">
          <div class="row-inline">
            <label for="riskFilter">위험군 필터</label>
            <select id="riskFilter"></select>
          </div>
          <div class="row-inline">
            <button id="reloadSamples" class="ghost-btn">샘플 새로고침</button>
          </div>
          <ul id="sampleList" class="sample-list"></ul>
        </div>

        <div id="manualTab" class="tab-content">
          <details open>
            <summary>Health (핵심)</summary>
            <div id="healthCoreFields" class="field-grid"></div>
          </details>

          <details open>
            <summary>Cognitive</summary>
            <div id="cogFields" class="field-grid"></div>
          </details>

          <details open>
            <summary>Bio</summary>
            <div id="bioFields" class="field-grid"></div>
          </details>

          <details open>
            <summary>Flags</summary>
            <div id="flagFields" class="field-grid"></div>
          </details>

          <details>
            <summary>Advanced MH*</summary>
            <div id="mhFields" class="field-grid mh-grid"></div>
          </details>
        </div>

        <div class="options-card">
          <h3>실행 옵션</h3>
          <label class="switch-line">
            <input type="checkbox" id="allowMissingToggle" />
            결측 허용 (데모 모드)
          </label>
          <label>
            타겟 민감도
            <select id="targetClassSelect">
              <option value="pred">예측 클래스 기준</option>
              <option value="MCI_High">MCI_High 기준</option>
            </select>
          </label>
          <div class="demo-btn-row">
            <button id="presetNormalBtn" class="ghost-btn" type="button">CN 데모 입력</button>
            <button id="presetMciBtn" class="ghost-btn" type="button">MCI 데모 입력</button>
            <button id="presetAdBtn" class="ghost-btn" type="button">AD 데모 입력</button>
          </div>
          <button id="runBtn" class="run-btn">Stage2 분류 실행</button>
          <p id="runMessage" class="hint"></p>
        </div>
      </section>

      <section class="panel center-panel">
        <h2>Pipeline Stepper</h2>
        <div id="stepper" class="stepper"></div>
      </section>

      <section class="panel right-panel">
        <div class="result-card">
          <div class="row-inline spread">
            <h2>Stage2 분류 확률 시각화</h2>
            <span class="pill">모델 분류 결과(운영 참고)</span>
          </div>
          <div id="triProbBar" class="tri-prob-bar">
            <div id="triSegNormal" class="tri-seg normal">NORMAL 0%</div>
            <div id="triSegMci" class="tri-seg mci">MCI 0%</div>
            <div id="triSegAd" class="tri-seg ad">AD 0%</div>
          </div>
          <div class="tri-chip-row">
            <span id="triChipNormal" class="tri-chip normal">NORMAL 0%</span>
            <span id="triChipMci" class="tri-chip mci">MCI 0%</span>
            <span id="triChipAd" class="tri-chip ad">AD 0%</span>
          </div>
          <div id="resultSummary" class="result-summary muted">실행 대기 중</div>
          <div class="row-inline badges">
            <span id="bucketBadge" class="badge idle">bucket -</span>
            <span id="stage3Badge" class="badge idle">Stage3 -</span>
          </div>
          <div id="mciGaugeCard" class="mci-gauge-card hidden">
            <div class="row-inline spread">
              <h3>MCI 세부화 게이지 (ANN)</h3>
              <span id="mciZoneBadge" class="badge idle">현재 구간: -</span>
            </div>
            <div class="mci-track">
              <div id="mciPin" class="mci-pin"></div>
            </div>
            <div class="mci-scale">
              <span>0 (양호)</span>
              <span>40 (중간)</span>
              <span>70 (위험)</span>
              <span>100</span>
            </div>
            <p id="mciScoreText" class="mci-score-text">점수 - · 세부화 -</p>
          </div>
        </div>

        <div class="result-card">
          <div class="row-inline spread">
            <h2>Local Sensitivity Top10</h2>
            <label class="small-toggle">
              <input type="checkbox" id="engOnlyToggle" />
              엔지니어링만
            </label>
          </div>
          <p id="sensitivityNote" class="hint"></p>
          <canvas id="sensitivityChart"></canvas>
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>Feature</th>
                  <th>Base</th>
                  <th>Perturbed</th>
                  <th>ΔTarget Prob</th>
                </tr>
              </thead>
              <tbody id="sensitivityBody"></tbody>
            </table>
          </div>
        </div>

        <div class="result-card">
          <h2>Branch Summary</h2>
          <p id="branchNote" class="hint"></p>
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>Branch</th>
                  <th>Dim</th>
                  <th>L2 Norm</th>
                  <th>Mean</th>
                  <th>Std</th>
                </tr>
              </thead>
              <tbody id="branchBody"></tbody>
            </table>
          </div>
        </div>
      </section>
    </main>

    <script src="utils/cssVar.js"></script>
    <script src="app.js"></script>
  </body>
</html>
